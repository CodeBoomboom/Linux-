# 内联函数inline

一个 C/[C++](http://c.biancheng.net/cplus/) 程序的执行过程可以认为是多个函数之间的相互调用过程，它们形成了一个或简单或复杂的调用链条，这个链条的起点是 main()，终点也是 main()。当 main() 调用完了所有的函数，它会返回一个值（例如`return 0;`）来结束自己的生命，从而结束整个程序。

函数调用是有时间和空间开销的。程序在执行一个函数之前需要做一些准备工作，要将实参、局部变量、返回地址以及若干寄存器都压入栈中，然后才能执行函数体中的代码；函数体中的代码执行完毕后还要清理现场，将之前压入栈中的数据都出栈，才能接着执行函数调用位置以后的代码。

为了消除函数调用的时空开销，C++ 提供一种提高效率的方法，即在编译时将函数调用处用函数体替换，类似于C语言中的宏展开。这种**在函数调用处直接嵌入函数体的函数**称为内联函数（Inline Function），又称内嵌函数或者内置函数。

**内联函数两个作用：**

1.消除函数调用时的开销

2.取代带参数的宏，如下：

若使用带参数的宏，需要考虑很多（要加的括号一定要加对，否则会出错）

```cpp
#define SQ(y) ( (y)*(y) )
```

但使用内联函数就简单了：

```cpp
inline int SQ(int y){ return y*y; }
```

**内联函数不应该有声明，应该将函数定义放在本应该出现函数声明的地方，这是一种良好的编程风格。**

在多文件编程中，我们通常将函数的定义放在源文件中，将函数的声明放在头文件中，希望调用函数时，引入对应的头文件即可，我们鼓励这种将函数定义和函数声明分开的做法。但这种做法不适用于内联函数，将内联函数的声明和定义分散到不同的文件中会出错，请看下面的例子。

main.cpp 代码：

```cpp
#include <iostream>
using namespace std;
//内联函数声明
void func();
int main(){
    func();
    return 0;
}
```

module.cpp 代码：

```cpp
#include <iostream>
using namespace std;
//内联函数定义
inline void func(){ 
	cout<<"inline function"<<endl;
}
```

上面的代码能够正常编译，但在链接时会出错。func() 是内联函数，编译期间会用它来替换函数调用处，编译完成后函数就不存在了，链接器在将多个目标文件（`.o`或`.obj`文件）合并成一个可执行文件时找不到 func() 函数的定义，所以会产生链接错误。

**在多文件编程时，建议将内联函数的定义直接放在头文件中**